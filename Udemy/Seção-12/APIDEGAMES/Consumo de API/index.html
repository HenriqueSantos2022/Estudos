<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja de games</title>
    <hr>
    <h4>Lista de games</h4>
    <ul id="games"></ul>

    <hr>
    <h4>Novo game</h4>
    <input type="text" name="title" id="title" placeholder="Titulo"><br>
    <input type="number" name="year" id="year" placeholder="Ano"><br>
    <input type="number" name="price" id="price" placeholder="Preço"><br>
    <button type="button" onclick="crateGame()">Criar</button>
    <hr>
    <h4>Editar games</h4>
    <input type="text" name="idEdit" id="idEdit" placeholder="ID"readonly><br>
    <input type="text" name="titleEdit" id="titleEdit" placeholder="Titulo"><br>
    <input type="number" name="yearEdit" id="yearEdit" placeholder="Ano"><br>
    <input type="number" name="priceEdit" id="priceEdit" placeholder="Preço"><br>
    <button type="button" onclick="updateGame()">Editar</button>
</head>

<body>

</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    function crateGame() {
        // PEGANDO REFERENCIA DOS INPUTS
        var inputTitle = document.getElementById("title");
        var inputYear = document.getElementById("year");
        var inputPrice = document.getElementById("price");

        // PEGANDO OS VALORES DOS INPUTS E CRIANDO A MENSAGEM PARA O SERVIDOR
        var game = {
            title: inputTitle.value,
            year: inputYear.value,
            price: inputPrice.value,
        }

        // ENVIADO DADOS PARA O SERVIDOR API CRIAR O GAME
        axios.post("http://localhost:7070/games", game).then(response => {
            if (response.status == 200) {
                alert("Game cadastrado!")
            }
        }).catch(error => {
            console.log(error);
        });
    }

    function updateGame() {
        console.log("TODO: updateGame");
    }

    function deleteGame(li) {
        // PEGA O ID ATRAVEZ DO ATRIBUTO DATA-ID
        var id = li.getAttribute("data-id");

        // ENVIA PARA O SERVIDOR O PEDIDO DE DELECAO DE UM ITEM
        axios.delete(`http://localhost:7070/games/${id}`).then(response => {
            alert("Game deletado!")
        }).catch(error => {
            console.log(error);
        });
    }

    // ESSA FUNCAO EDITA JOGOS ATRAVEZ DA REFERENCIA INPUT/ID-EDIT 
    function loadForm(li) {
        var id = li.getAttribute("data-id");
        var title = li.getAttribute("data-title");
        var year = li.getAttribute("data-year");
        var price = li.getAttribute("data-price");
        document.getElementById("idEdit").value = id;
        document.getElementById("titleEdit").value = title;
        document.getElementById("yearEdit").value = year;
        document.getElementById("priceEdit").value = price;

    }

    function start() {
        // PEDINDO AO SERVIDOR A LISTA DE TODOS OS GAMES
        axios.get("http://localhost:7070/games").then(response => {
            var games = response.data;
            var ul = document.getElementById("games");

            games.forEach(game => {

                // CRIANDO E DEFINIDO OS ATRIBUTOS DA NOVA LI/ITEM
                var li = document.createElement("li");
                li.setAttribute("data-id", game.id);
                li.setAttribute("data-title", game.title);
                li.setAttribute("data-year", game.year);
                li.setAttribute("data-price", game.price);
                li.innerHTML = `${game.id} - ${game.title} - $${game.price}`;

                // ADICIONANDO O BOTAO DELETAR AO LI
                var btnDelete = document.createElement("button");
                btnDelete.innerHTML = "Deletar";
                btnDelete.addEventListener("click", function () {
                    deleteGame(li)
                })
                li.appendChild(btnDelete);

                // ADICIONANDO O BOTAO EDITAR AO LI
                var btnEdit = document.createElement("button");
                btnEdit.innerHTML = "Editar";
                btnEdit.addEventListener("click", function () {
                    loadForm(li);
                    console.log(`TODO: botao de editar`);
                })
                li.appendChild(btnEdit)

                // ADIONANDO A NOVA LI AO UL
                ul.appendChild(li);
            });

        }).catch(error => {
            console.log(error);
        });
    }

    start()
</script>

</html>